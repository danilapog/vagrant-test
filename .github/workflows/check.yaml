### This workflow setup instance then build and push images ###
name: Build DocSpace-pipedrive

on:
  workflow_dispatch:
    inputs:
      backend_url:
        description: "Specify backend url"
        type: string
      product_version:
        description: "Specify product version"
        type: string
      
jobs:
  build:
    name: "Build DocSpace-pipedrive"
    runs-on: ubuntu-latest
    strategy:
      fail-fast: false
    steps:
      - name: Checkout code 
        uses: actions/checkout@v4
        with:
          repository: ONLYOFFICE/onlyoffice-docspace-pipedrive

      - name: Set up QEMU
        uses: docker/setup-qemu-action@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      #- name: Login to Container Registry
      #  uses: docker/login-action@v3
      #  with:
      #    registry: ${{ secrets.DOCKER_TEST_REGISTRY }}
      #    username: ${{ secrets.DOCKER_TEST_USERNAME }}
      #    password: ${{ secrets.DOCKER_TEST_ACCESS_TOKEN }}

      - name: Build
        env:
           BACKEND_URL: ${{  github.event.inputs.backend_url }}
           PRODUCT_VERSION: ${{ github.event.inputs.product_version }}
        run: |
          docker compose build \
               --build-arg BACKEND_URL=$BACKEND_URL
          docker compose push
